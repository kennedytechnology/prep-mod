<h1 class="text-red-700 font-bold text-2xl p-2 mb-6">
    <%= t "views.public.patients.edit.personal_info.#{school_mode? ? 'school_mode_title' : 'regular_title'}" %>
</h1>

<div class="field-side-by-side">
    <div class="md:flex lg:flex">
        <div class="w-full md:w-9/12 md:mr-2 lg:w-8/12 lg:mr-2">
            <%= f.label :first_name do %>
               <% if school_mode? %> 
                <%= t('activerecord.models.patient.student_first_name') %>
               <% else %>
                 <%= t 'static_pages.public.patients.consent_form.personal_information.first_name' %>
               <% end %>
               <span class="field-required">*</span>
            <% end %>
            <%= f.text_field :first_name, disabled: @patient.access_code.present?, class: "form-input w-full", required: true %>
        </div>
        <div class="flex-1">
            <%= f.label :middle_initial do %>
                <% if school_mode? %>
                    <%= t('activerecord.models.patient.student_middle_initial') %>
                <% else %>
                    <%= t('static_pages.public.patients.consent_form.personal_information.middle_initial') %>
                <% end %>
            <% end %>
            <%= f.text_field :middle_initial, disabled: @patient.access_code.present?, class: "form-input w-full" %>
        </div>
    </div>
    <div class="md:flex lg:flex">
        <div class="flex-1 md:mr-2 lg:mr-2">
            <%= f.label :last_name do %>
                <% if school_mode? %> 
                    <%= t('activerecord.models.patient.student_last_name') %>
                <% else %>
                    <%= t 'static_pages.public.patients.consent_form.personal_information.last_name' %>
                <% end %>
                <span class="field-required">*</span>
            <% end %>
            <%= f.text_field :last_name, disabled: @patient.access_code.present?, class: "w-full form-input", required: true %>
        </div>
        <div class="flex-1">
            <%= f.label :mothers_maiden_name, t('static_pages.public.patients.consent_form.personal_information.mothers_maiden_name') %><span class="field-required">*</span>
            <%= f.text_field :mothers_maiden_name, class: "form-input w-full", required: true %>
        </div>
    </div>
</div>

<div class="field-side-by-side" data-controller="age-calculator">
    <div class="md:flex lg:flex">
        <div class="flex-1 md:mr-2 lg:mr-2">
            <%= f.label :date_of_birth do %>
                <%= t 'static_pages.public.patients.consent_form.personal_information.date_of_birth' %> <span class="field-required">*</span>
            <% end %>
            <%#= f.text_field :date_of_birth, value: @patient.date_of_birth.try(:strftime, "%Y/%m/%d"), class: "w-full form-input",
                                required: true,
                                data: { controller: "flatpickr",
                                        flatpickr_max_date: "today",
                                        action: "age-calculator#calculateAge",
                                        target: "age-calculator.dobField"} %>
            <div class="flex">
                <%= cw_date_field(f, :date_of_birth, {class: "form-input w-full", value: @patient.date_of_birth.try(:strftime, "%Y/%m/%d"), required: true},
                    {'data-controller' => 'flatpickr',
                    'data-flatpickr-max-date' => Time.zone.now,
                    'data-action' => 'age-calculator#calculateAge',
                    'data-target' => 'age-calculator.dobField'
                    }
                ) %>
            </div>
        </div>
        <div class="flex-1 md:mr-2 lg:mr-2">
            <%= f.label t('static_pages.public.patients.consent_form.personal_information.age') %>
            <%= f.text_field :age, class: "w-full form-input", data: {target: "age-calculator.ageField"}%>
        </div>
        <div class="flex-1 md:mr-2 lg:mr-2">
            <%= f.label :sex do %>
                <%= t 'static_pages.public.patients.consent_form.personal_information.gender' %> <span class="field-required">*</span>
            <% end %>
            <%= f.select :sex, [["Male", "M"], ["Female", "F"], ["Other", "O"]], {include_blank: true}, {class: "form-select w-full", required: true} %>
        </div>
    </div>

    <% if school_mode? %>
    <div class="flex">
        <div class="flex-1 mr-2">
            <%= f.label :grade, class: "block" do %>
                <%= t('activerecord.models.patient.grade') %>
                <span class="field-required">*</span>
            <% end %>
            <%= f.text_field :grade, class: "w-full form-input", required: true %>
        </div>
        <div class="flex-1">
            <%= f.label :homeroom_teacher, t('activerecord.models.patient.homeroom_teacher'), class: "block" %>
            <%= f.text_field :homeroom_teacher, class: "w-full form-input" %>
        </div>
    </div>
</div>

    <div class="field-side-by-side" data-controller="select-child-items">
        <div>
            <%= f.label :county, t('activerecord.models.patient.county'), class: "block" %>
            <% county_options = Venue.all.collect(&:county).uniq.collect{|c| [c, c, data: {child_items: options_for_select(Venue.where(county: c).collect{|v| [v.name, v.id]}, f.object.venue_id) }]} %>
            <%= f.select :county, options_for_select(county_options, f.object.county), {include_blank: true}, class: 'form-select w-full', data: {target: 'select-child-items.parent', action: 'select-child-items#update'} %>
        </div>
        <div>
            <%= f.label :venue_id, t('activerecord.models.patient.school'), class: "block" %>                
            <%= f.select :venue_id, options_for_select([]), {include_blank: true}, class: 'form-select w-full', data: {target: 'select-child-items.children'} %>
        </div>
    </div>

    <div class="field-fullwidth">
        <div class="flex" data-controller="email-confirmation">
            <div class="w-1/2 mr-3">
                <%= f.label :guardian_first_name, class: "block" do %>
                    Parent/Guardian's First Name <span class="field-required"> * </span>
                <% end %>
                <%= f.text_field :guardian_first_name, class: "w-full form-input block", required: true %>
            </div>

            <div class="w-1/2 mr-1">
                <%= f.label :guardian_last_name, class: "block" do %>
                    Parent/Guardian's Last Name <span class="field-required"> * </span>
                <% end %>
                <%= f.text_field :guardian_last_name, class: "w-full form-input block", required: true %>
            </div>

            <div class="w-1/2 mr-3 ml-3">
            <%= f.label :guardian_email do %>
                Parent/Guardian Email Address <span class="field-required">*</span>
            <% end %>
            <%= f.email_field :guardian_email, class: "w-full form-input block", required: true,
                data: {
                    action: "keyup->email-confirmation#emailConfirmation
                            change->email-confirmation#emailConfirmation",
                    target: "email-confirmation.emailField"}%>
            </div>

            <div class="w-1/2 mr-1">
                <label> Retype Parent/Guardian Email Address <span class="field-required">*</span> </label>
                <input type="email" class="form-input w-full" value="<%= @patient.guardian_email %>" required="required"
                    data-action="keyup->email-confirmation#emailConfirmation change->email-confirmation#emailConfirmation"
                    data-target="email-confirmation.confirmEmailField" />
                <p class="text-red-600 -mt-2" data-target="email-confirmation.confirmEmailError"> </p>
            </div>
        </div>
    </div>
    <% else %>
    <div class="flex" data-controller="email-confirmation">
        <div class="flex-1 flex mr-2">
            <div class="w-1/2 mr-1">
                <%= f.label :email do %>
                    Email Address <span class="field-required">*</span>
                <% end %>
                <%= f.email_field :email, class: "w-full form-input block", required: true,
                    data: {
                        action: "keyup->email-confirmation#emailConfirmation
                                change->email-confirmation#emailConfirmation",
                        target: "email-confirmation.emailField"}%>
            </div>
            <div class="w-1/2 mr-1">
                <label> Retype Email Address <span class="field-required">*</span> </label>
                <input type="email" class="form-input w-full" value="<%= @patient.email %>" required="required"
                    data-action="keyup->email-confirmation#emailConfirmation change->email-confirmation#emailConfirmation"
                    data-target="email-confirmation.confirmEmailField" />
                <p class="text-red-600 -mt-2" data-target="email-confirmation.confirmEmailError"> </p>
            </div>
        </div>
    </div>
</div>
    <% end %>

<div class="field-side-by-side">
    <div class="flex">
        <div class="flex-1 mr-2">
            <%= f.label :address do %>
                <%= t 'static_pages.public.patients.consent_form.personal_information.address' %> <span class="field-required">*</span>
            <% end %>
            <%= f.text_field :address, id: "autocomplete", onFocus: "geolocate()", class: "form-input w-full", required: true %>
            <%= render partial: "public/clinics/google_maps_script" %>
        </div>
        <div class="flex-1">
            <%= f.label :city do %>
                <%= t 'static_pages.public.patients.consent_form.personal_information.city' %> <span class="field-required">*</span>
            <% end %>
            <%= f.text_field :city, id: "locality", class: "form-input w-full", required: true %>
        </div>
    </div>
    <div class="flex">
        <div class="flex-1 mr-2">
            <%= f.label :state do %>
                <%= t 'static_pages.public.patients.consent_form.personal_information.state' %> <span class="field-required">*</span>
            <% end %>
            <%= f.select :state, options_for_select(US_STATES, @patient.state), {include_blank: true}, {id: "administrative_area_level_1", class: "form-select w-full", required: true} %>
        </div>
        <div class="flex-1">
            <%= f.label :zip_code do %>
                <%= t 'static_pages.public.patients.consent_form.personal_information.zip_code' %> <span class="field-required">*</span>
            <% end %>
            <%= f.text_field :zip_code, id: "postal_code", class: "form-input w-full", required: true %>
        </div>
    </div>
</div>
<div class="field-side-by-side">
    <div>
        <%= f.label :phone_number do %>
            <%= t 'static_pages.public.patients.consent_form.personal_information.phone_number' %> <span class="field-required">*</span>
        <% end %>
        <%= f.text_field :phone_number, class: "form-input w-full", required: true %>
    </div>
    <div> </div>
</div>

<%= hidden_field_tag :next_step, "health_insurance" %>
