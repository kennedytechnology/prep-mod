<span class="text-xl font-bold">
  <%= t 'views.public.patients.edit.add_family.header' %>
</span>

<div data-controller="consent-form-signature">
  <%= f.fields_for :patient_family_members do |fm| %>
    <div class="member-<%= fm.object.object_id %>">
       <div class="flex justify-between mt-20">
        <h2 class="text-xl font-bold"> <%= t 'views.public.patients.edit.add_family.family_member_section' %> </h2>
        <%= fm.hidden_field :_destroy %>
        <%= link_to t('views.public.patients.edit.add_family.delete_member'), 'javascript:',
            class: 'button-danger',
            style: "width: auto; height: 25px; font-size: 0.75rem",
            data: {
              member: "#{fm.object.object_id}",
              action: "click->consent-form-signature#onRemoveFamilyMember"
            } %>
        </div>

      <div class="family-member-form mt-6 border-b">
        <div class="w-full md:flex">
          <div class="inline-field-wrapper">
              <%= fm.label :first_name do %>
                <span> <%= t 'activerecord.models.patient.first_name' %> </span>
                <span class="field-required">*</span>
              <% end %>
              <%= fm.text_field :first_name, class: "w-full form-input", required: true %>
          </div>
          <div class="inline-field-wrapper inline-field-wrapper-narrow">
              <%= fm.label :middle_initial, t('activerecord.models.patient.middle_initial') %>
              <%= fm.text_field :middle_initial, class: "w-full form-input" %>
          </div>
          <div class="inline-field-wrapper">
              <%= fm.label :last_name do %>
                <span> <%= t 'activerecord.models.patient.last_name' %> </span>
                <span class="field-required">*</span>
              <% end %>
              <%= fm.text_field :last_name, class: "w-full form-input", required: true %>
          </div>
          <div class="inline-field-wrapper">
              <%= fm.label :mothers_maiden_name do %>
                <span> <%= t 'activerecord.models.patient.mothers_maiden_name' %> </span>
                <span class="field-required">*</span>
              <% end %>
              <%= fm.text_field :mothers_maiden_name, class: "w-full form-input", required: true %>
          </div>
          
          <div class="inline-field-wrapper">
            <%= fm.label :date_of_birth do %>
                <span> <%= t 'activerecord.models.patient.date_of_birth' %> </span>
                <span class="field-required">*</span>
            <% end %>
            <%#= fm.text_field :date_of_birth, class: "w-full form-input", required: true,
                                  data: { controller: "flatpickr", flatpickr_max_date: "today" } %>
              <div class="flex">
                <%= cw_date_field(fm, :date_of_birth, {class: "form-input w-full", required: true},
                            {'data-controller' => 'flatpickr',
                            'data-flatpickr-max-date' => Time.zone.now
                            }
                ) %>
              </div>
            </div>

          </div>
        </div>

        <div class="md:flex" data-controller="same-as-parent">
          <div class="inline-field-wrapper pt-7">
          <label>
            <input type="checkbox" data-action="change->same-as-parent#applyValues">
            <%= t 'views.public.patients.edit.add_family.same_insurance' %></label>
          </div>

          <div class="inline-field-wrapper">
            <%= fm.label :insurance_company_name, t('activerecord.models.patient.insurance_company_name') %>
            <%= fm.text_field :insurance_company_name, class: "w-full form-input", data: {parent_field: @patient.insurance_company_name, target: "same-as-parent.field" } %>
          </div>

          <div class="inline-field-wrapper">
            <%= fm.label :member_id_for_insurance, t('activerecord.models.patient.member_id_for_insurance') %>
            <%= fm.text_field :member_id_for_insurance, class: "w-full form-input", data: {parent_field: @patient.member_id_for_insurance, target: "same-as-parent.field" } %>
          </div>

          <div class="inline-field-wrapper">
            <%= fm.label :group_number_for_insurance, t('activerecord.models.patient.group_number_for_insurance') %>
            <%= fm.text_field :group_number_for_insurance, class: "w-full form-input", data: {parent_field: @patient.group_number_for_insurance, target: "same-as-parent.field" } %>
          </div>
        </div>

        <% if school_mode? %>
            <%= render partial: "public/patients/edit/health_questions_school", locals: {f:fm} %>
        <% else %>
            <%= render partial: "public/patients/edit/health_questions_regular", locals: {f:fm} %>
        <% end %>
      </div>
  <% end %>
</div>