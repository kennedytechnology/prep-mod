<div class="patients-table-section" data-controller="clinic-activity-patients">
    <div class="patients-table-header">
        <div class="mt-12">
            <div class="flex w-1/3">
                <label class="flex items-center text-lg mr-3 text-gray-600 block" for="search"> Search Here </label>
                <input class="form-input w-2/3" id="search" data-action="keyup->clinic-activity-patients#search" type="text">
            </div>
        </div>
        <div class="flex justify-end mb-3">
            <%= link_to sanitize("Add More Patients &#43;"), "javascript:", data: {action: "clinic-activity-patients#showModal", selection: "AddPatient"}, class: "button-primary" %>
        </div>
    </div>
    <div class="patients-table-outer">
        <div class="patients-table-wrapper">
        <div class="patients-table-container">
            <table class="table">
            <thead>
            <tr>
                <th>Patient Name</th>
                <th>DOB</th>
                <th>Screened</th>
                <th>Tested</th>
                <th>Safety Kit</th>
                <th>Cancelled</th>
                <th>No Show</th>
                <th>Follow Up</th>
                <th>Remark</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <% @clinic.patients.each do |patient| %>
                <%= form_with model: patient.event_for_clinic(@clinic), remote: true, class: "clinic_event_#{patient.id}_form" do |event_form| %>
                <tr data-target="clinic-activity-patients.searchableRow" 
                    data-event-category="<%= event_form.object.category %>" 
                    data-search-content="<%= [patient.first_name.downcase, patient.last_name.downcase].join(" ") %>" 
                    data-patient-id="<%= patient.id %>">
                    <td>
                    <%= event_form.hidden_field :patient_id %>
                    <%= event_form.hidden_field :clinic_id %>
                    <%= render partial: '/clinics/activity/screened_details', layout: "clinics/activity/clinic_event_modal", locals: {patient: patient, event_form: event_form, category_selection: 'Screened'} %>
                    <%= render partial: '/clinics/activity/tested_details', layout: "clinics/activity/clinic_event_modal", locals: {patient: patient, event_form: event_form, category_selection: 'Tested'} %>
                    <%= render partial: '/clinics/activity/remark_details', layout: "clinics/activity/clinic_event_modal", locals: {patient: patient, event_form: event_form, category_selection: 'Remark'} %>
                    <%= link_to patient.first_name + ' ' + patient.last_name, patient, class: "underline" %> <br/>
                    </td>
                    <td><%= patient.date_of_birth.try(:strftime, "%D") %></td>
                    <td class="relative">
                      <div class="absolute bg-transparent h-4 w-4"
                           style="top: 26px; left: 8px;"
                           data-action="click->clinic-activity-patients#showModal"
                           data-selection="Screened"></div>
                      <%= event_form.radio_button :category, "Screened", data: {selection: "Screened"}, class: "form-radio" %>
                    </td>
                    <td class="relative">
                      <div class="absolute bg-transparent h-4 w-4"
                           style="top: 26px; left: 8px;"
                           data-action="click->clinic-activity-patients#showModal"
                           data-selection="Tested"></div>
                      <%= event_form.radio_button :category, "Tested", data: {selection: "Tested"}, class: "form-radio" %>
                    </td>
                    <td><%= event_form.check_box :safety_kit_received, class: "form-checkbox", onclick: "Rails.fire(this.form, 'submit');" %></td>
                    <td><%= event_form.radio_button :category, "Cancelled", class: "form-radio", onclick: "Rails.fire(this.form, 'submit');"  %></td>
                    <td><%= event_form.radio_button :category, "No Show", class: "form-radio", onclick: "Rails.fire(this.form, 'submit');"  %></td>
                    <td><%= event_form.radio_button :category, "Follow Up", class: "form-radio", onclick: "Rails.fire(this.form, 'submit');"  %></td>
                    <td><%= link_to "Remark", "javascript:", data: {action: "clinic-activity-patients#showModal", selection: "Remark"}, class: "form-text" %></td>
                    <td>
                    <div class="flex">
                        <%= link_to "Delete", "javascript:",
                                    data: { recordIs: "patients", recordId: patient.id,
                                            recordName: patient.full_name,
                                            action: "click->clinic-activity-patients#showHideDeleteModal" },
                                    class: "button-action mb-0" %>
                    </div>
                    </td>
                </tr>
                <% end %>
            <% end %>
            </tbody>
            </table>
        </div>
        </div>
    </div>

    <%= render "clinics/activity/delete_record_modal" %>
</div>
